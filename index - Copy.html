<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Mine Sweeper </title>
  <style>
    table,
    tr,
    td {
      border: 1px solid rgb(127, 127, 127);
      border-collapse:
        collapse;
    }

    body {
      font-size: 12px;
    }

    td {
      height: 10px;
      width: 10px;
      display:
        inline-block;
      padding: 10px 10px;
      background-color: #ffffff;
      /*color: rgb(185,
      185, 185);*/
      text-align: center;
      transition: all 0.1s ease;
    }

    td:active {
      box-shadow: inset 3px 3px #000000;
    }

    .zeroed {
      box-shadow: inset 2px 2px #dddddd;
    }

    td:disabled,
    td[disabled] {
      border: 1px solid #999999;
      background-color:
        #cccccc;
      color: #666666;


    }

    .mine {
      background-color: #ffaa22 !important;
      ;
    }
  </style>
</head>

<body>
  <section id="mine_field"></section>
  <script type="text/javascript">
    const num_cols = 10 //
    const num_rows = 15
    const mine_percent = .15 // limita los nums aleatorios a 25
    const grid_size = (num_cols * num_rows)
    const cell = []
    var firstClick = true;
    create_board(num_cols, num_rows)
    var neighbor_mines = []

    function create_board(num_cols, num_rows) {
      var table = document.createElement("table");
      table.setAttribute("id", "myTable");
      document.body.appendChild(table);
      let num = 1;
      for (let j = 0; j < num_cols; j++) {
        let tr = document.createElement("tr");
        tr.setAttribute("id", "myTr" + j);
        document.getElementById("myTable").appendChild(tr);
        cell[j] = [];
        for (let i = 0; i < num_rows; i++) {
          let td = document.createElement("td");
          td.setAttribute("id", "cell_" + j + "-" + i);
          td.setAttribute("data-row", j);
          td.setAttribute("data-col", i);
          cell[j][i] = { mine: false, num: num };
          document.getElementById("myTr" + j).appendChild(td);
          num++;
        }
      }
      console.log(cell)
    }

    function mine_random_location(grid_size) {
      let random_number = Math.floor(Math.random() * grid_size)
      let random_numbers = []
      for (let i = 0; i < num_cols; i++) {
        for (let j = 0; j < num_rows; j++) {
          if (random_numbers.length > (grid_size * mine_percent)) break // limita los nums aleatorios
          random_number = Math.floor(Math.random() * grid_size) // crea un número aleatorio
          let number_exists = random_numbers.includes(random_number);
          // comprueba si el número ya existe
          if (!number_exists) {
            random_numbers.push(Number(random_number))
          }
          random_numbers.sort((function (a, b) {
            return a - b
          })) // ordena los numeros ascendentemente
        }
      }
      console.log(random_numbers)
      return random_numbers
    }

    function lay_mines(row, col) {
      let currentCell = document.getElementById("cell_" + row + "-" + col)
      if (firstClick) {
        document.getElementById("cell_" + row + "-" + col).setAttribute('safe', 'true');
        let td_mine_rand = mine_random_location(grid_size)
        let td_randomize = document.getElementsByTagName("td")

        for (let i = 0; i < num_rows; i++) {
          for (let j = 0; j < num_cols; j++) {
             let isSafe = document.getElementById("cell_" + i + "-" + j)
             cell[row][col].mine = true;
          }
        }

        /*  for (let i = 0; i < td_mine_rand.length; i++) {
           let isSafe = td_randomize[td_mine_rand[i]].getAttribute("safe")
           if (!isSafe) {
             //td_randomize[td_mine_rand[i]].classList.add("mine")
             td_randomize[td_mine_rand[i]].setAttribute('mine', 'true');
             //double property for searching
 
 
           }
         } */
        firstClick = false
      }
    }

    function click() {
      document.onclick = (e) => {
        e.preventDefault();
        return e.target
      }
    }

    //===============================================================
    document.onclick = (e) => {
      e.preventDefault();


      let row = e.target.dataset.row;
      let col = e.target.dataset.col;
      let clicked = document.getElementById("cell_" + row + "-" + col);

      //Dar color gris a la celda sobre la que se hace click y no tiene minas

      //Poner minas
      lay_mines(row, col)
      if (!cell[row][col].mine) {
        clicked.style.backgroundColor = "#ccc"
        //console.log("current cell: " + cell[row][col].mine)
      }
      console.log(row + "-" + col)

      for (let i = 0; i < num_rows; i++) {
        for (let j = 0; j < num_cols; j++) {
          console.log(row + "." + col + " - " + cell[row][col].mine);

        }
      }
      // borrar - console.log(cell)

      //Buscar minas adyacentes
      buscar_minas_adyacentes()
      /*let neighbors = count_neighbor_mines(row, col, clicked)
      console.log(neighbors)
      clicked.innerHTML = neighbors*/
    }

    function buscar_minas_adyacentes() { }

    function count_neighbor_mines(row, col, clicked) {
      let counter = 0
      return counter
    }
    document.oncontextmenu = (event) => {
      event.preventDefault()
    }
      /*if (row==0 && col==0){
let isMine = document.getElementById("cell_" + ((row*1)+1)  + "-" + col)
if( isMine.getAttribute("mine")) counter++
isMine = document.getElementById("cell_" + ((row*1)+1)  + "-" + ((col*1)+1) )
if( isMine.getAttribute("mine")) counter++
isMine = document.getElementById("cell_" + row + "-" + ((col*1)+1))
if( isMine.getAttribute("mine")) counter++
}*/
      //console.log("firstClick " + firstClick)
      //var cell = e.target;
      //var classes = cell.classList;
      //var cellId = e.target.getAttribute("id");
      //let location = (row *1+1) * (col *1+1)
      //console.log("location  "+ location )
      //classes.toggle("mine ")
      //tdbg[Math.floor(Math.random() * grid_size)].style.backgroundColor = "#ffaadd"
      //currentCell.style.backgroundColor = "#aaffdd"
      //        currentCell.getAttribute("class")
      //        console.log("Att name: "+test)

           //Comprobar si hay minas
    /*    try {
         nonExistentFunction();
       } catch (error) {
         console.error(error);
         // Expected output: ReferenceError: nonExistentFunction is not defined
         // (Note: the exact output may be browser-dependent)
       } */
    /*  if (clicked.getAttribute("mine")) {
       //mostrador de minas en color
       let caboom = document.getElementsByClassName("mine")
       for (let i = 0; i < caboom.length; i++) {
         caboom[i].style.backgroundColor = "#ffaa22"
       }
     } */
  </script>
  <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
  <svg version="1.1" id="レイヤー_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
    y="0px" width="26px" height="26px" viewBox="0 0 76 76" enable-background="new 0 0 76 76" xml:space="preserve">
    <g>
      <g>
        <path id="rect1313_65_" fill="#FDFCFD" d="M0.009,0h75.982C75.996,0,76,0.004,76,0.009V75.99c0,0.006-0.004,0.01-0.009,0.01H0.009
          C0.004,76,0,75.996,0,75.99V0.009C0,0.004,0.004,0,0.009,0z" />
        <path id="path1341_65_" fill="#757575" d="M75.99,0C75.995,0,76,0.005,76,0.01v75.981C76,75.996,75.995,76,75.99,76H0.009
          C0.004,76,0,75.996,0,75.991L75.99,0z" />
        <polygon id="rect1311_65_" fill="#B9B9B9" points="8.508,8.5 67.492,8.5 67.5,8.508 67.5,67.491 67.492,67.5 8.508,67.5 
          8.5,67.491 8.5,8.508 		" />
      </g>
      <g>
        <polygon points="35.999,55.5 35.999,16.5 40,16.5 40,55.5 35.999,55.5 		" />
        <polygon fill="#FF0000" points="40,13.875 19.375,27 40,40.125 		" />
        <rect x="28.571" y="51.625" width="18.857" height="5.5" />
        <rect x="20.222" y="56.459" width="35.555" height="7.041" />
      </g>
    </g>
  </svg>
</body>

</html>